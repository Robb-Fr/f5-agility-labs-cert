<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>F5N1 - Management</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="F5N1 - Management"/>
  <meta name="product" content="Unofficial - F5 Certification Exam Prep Material"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2024-06-19 03:01:48"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="Unofficial - F5 Certification Exam Prep Material" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>F5N1 - Management &#8212; Unofficial - F5 Certification Exam Prep Material  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="F5N2 - Configuration: Knowledge" href="module2.html" />
    <link rel="prev" title="F5 N1-N4 - NGINX OSS - NOT CREATED" href="../class21.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>Unofficial - F5 Certification Exam Prep Material  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Intro:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Getting Started with the F5 Certification Program - Created 03/29/19</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 101 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">F5 101 - App Delivery Fundamentals Exam Study Guide - Created 03/06/20</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 201 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">F5 201 - TMOS Administration Exam Study Guide - New One Not Created Yet</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 201 Certification Lab:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">F5 201 - TMOS Administration Labs (V13.1)</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 202 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">F5 202 - Pre-Sales Fundamentals Exam Study Guide - Created 11/01/19</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 301A Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class7/class7.html">F5 301A - BIG-IP LTM Specialist: Architect, Set-Up &amp; Deploy Exam Study Guide - Created 11/01/19</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class8/class8.html">F5 301A - BIG-IP LTM Specialist Labs - Created 11/01/19</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 301B Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class9/class9.html">F5 301B - BIG-IP LTM Specialist: Maintain and Troubleshoot Exam Study Guide - Created 11/01/19</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 302 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class11/class11.html">F5 302 - BIG-IP DNS Specialist Exam Study Guide - NOT CREATED</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 303 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class13/class13.html">F5 303 - BIG-IP ASM Specialist Study Guide - NOT CREATED</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 304 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class15/class15.html">F5 304 - BIG-IP APM Specialist Study Guide - NOT CREATED</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 401 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class17/class17.html">F5 401 - Security Solution Expert Study Guide - Created 09/26/18</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - 402 Certification Exam Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class19/class19.html">F5 402 - Cloud Solutions Study Guide - NOT CREATED</a></li>
</ul>
<p class="caption"><span class="caption-text">Unofficial - Nginx OSS Certification Exam Resources:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../class21.html">F5 N1-N4 - NGINX OSS - NOT CREATED</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">F5N1 - Management</a><ul>
<li><a class="reference internal" href="#exam-summary">Exam summary</a></li>
<li><a class="reference internal" href="#objective-1-1-given-a-scenario-identify-when-to-use-nginx">Objective - 1.1 Given a scenario identify when to use NGINX</a></li>
<li><a class="reference internal" href="#objective-1-2-explain-the-nginx-configuration-directory-structure">Objective - 1.2 Explain the NGINX configuration directory structure</a></li>
<li><a class="reference internal" href="#objective-1-3-demonstrate-how-to-manage-user-permissions">Objective - 1.3 Demonstrate how to manage user permissions</a></li>
<li><a class="reference internal" href="#objective-1-4-manage-shared-memory-zones">Objective - 1.4 Manage shared memory zones</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">Unofficial - F5 Certification Exam Prep Material</a>
              &gt; <a href="../class21.html">F5 N1-N4 - NGINX OSS - NOT CREATED</a>

          <span class="right">
             <a href="../../_sources/class21/modules/module1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-cert">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="f5n1-management">
<h1>F5N1 - Management<a class="headerlink" href="#f5n1-management" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="section" id="exam-summary">
<h2>Exam summary<a class="headerlink" href="#exam-summary" title="Permalink to this headline">¶</a></h2>
<p>The F5 NGINX Management exam is one of four NGINX exams candidates are required
to pass to achieve the F5 Certified, Administrator, NGINX. The exams may be
taken in any order. The NGINX certification is based on NGINX Open Source
Software, not NGINX+.</p>
<p>The F5 NGINX Management exam ensures that the candidates have the skills and
understanding necessary for day-to-day management of an NGINX web server
platform.</p>
<p>This module goes through all the elements evaluated as specified in the exam
blueprint and gives insights, details but above all resources to guide
candidates in their study for these exams.</p>
<p>The covered material explores the content of the Management exam, axed around
<strong>understanding the purposes of NGINX</strong> as well as being able to demonstrate
abilities to <strong>understand NGINX structure</strong>: both in its <em>configuration
organisation</em> and <em>as a Linux process</em>.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="objective-1-1-given-a-scenario-identify-when-to-use-nginx">
<h2>Objective - 1.1 Given a scenario identify when to use NGINX<a class="headerlink" href="#objective-1-1-given-a-scenario-identify-when-to-use-nginx" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p><strong>1.1 - Describe NGINX as a web server</strong></p>
<p><a class="reference external" href="https://nginx.org/en/">https://nginx.org/en/</a></p>
<p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/web-server/web-server/">https://docs.nginx.com/nginx/admin-guide/web-server/web-server/</a></p>
<p>Slide 11 <a class="reference external" href="https://f5u.csod.com/ui/lms-learning-details/app/course/f62cdc17-e0df-4117-820c-6270100981a2">https://f5u.csod.com/ui/lms-learning-details/app/course/f62cdc17-e0df-4117-820c-6270100981a2</a></p>
<p><strong>NGINX handling web protocols</strong></p>
<p>One of NGINX’s key feature is its web server functionality. NGINX software
indeed implements many features related to the HTTP (web) protocol and can be
configured to serve web content, making it describable as a web server. At a
high level, configuring NGINX Plus as a web server is a matter of defining
which URLs it handles and how it processes HTTP requests for resources at those
URLs. At a lower level, the configuration defines a set of virtual servers that
control the processing of requests for particular domains or IP addresses.</p>
<p>The most basic web server feature that can be handled by NGINX is serving
static content. The following snippet shows a basic example of NGINX
configuration file for serving static web content:</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">http</span> <span class="p">{</span>
    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">root</span> <span class="s">/www/data</span><span class="p">;</span>

        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Receiving this configuration file, NGINX would listen to the HTTP port 80 on
the host machine for incoming connections. Upon receiving HTTP request, it
would serve content from the host’s <code class="docutils literal notranslate"><span class="pre">/www/data</span></code> directory (for example, a
<code class="docutils literal notranslate"><span class="pre">/www/data/index.html</span></code> file).</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.1 - Describe NGINX as a reverse proxy</strong></p>
<p><a class="reference external" href="https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/">https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/</a></p>
<p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/">https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/</a></p>
<p><a class="reference external" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html">https://nginx.org/en/docs/http/ngx_http_proxy_module.html</a></p>
<p>Slide 8 and 13 <a class="reference external" href="https://f5u.csod.com/ui/lms-learning-details/app/course/f62cdc17-e0df-4117-820c-6270100981a2">https://f5u.csod.com/ui/lms-learning-details/app/course/f62cdc17-e0df-4117-820c-6270100981a2</a></p>
<p><strong>What is reverse proxying and why do so</strong></p>
<p>A reverse proxy is a server that sits in front of web servers and forwards
client (e.g. web browser) requests to those web servers. Reverse proxies are
typically implemented to help increase security, performance, and reliability.</p>
<p>Proxying is typically used to distribute the load among several servers,
seamlessly show content from different websites, or pass requests for
processing to application servers over protocols other than HTTP.</p>
<img alt="Reverse proxy flow" src="../../_images/reverse_proxy_flow.jpg" />
<p>Reverse proxy flow illustrated. A reverse proxy sits just before the
application servers in the classic client-server network architecture. (from
<a class="reference external" href="https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/">https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/</a>).</p>
<p><strong>How can NGINX be a reverse proxy</strong></p>
<p>When NGINX proxies a request, it sends the request to a specified proxied
server, fetches the response, and sends it back to the client. It is possible
to proxy requests to an HTTP server (another NGINX server or any other server)
or a non-HTTP server (which can run an application developed with a specific
framework, such as PHP or Python) using a specified protocol. Supported
protocols include FastCGI, uwsgi, SCGI, and memcached.</p>
<p>To pass a request to an HTTP proxied server, the proxy_pass directive is
specified inside a location.</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">location</span> <span class="s">/some/path/</span> <span class="p">{</span>
    <span class="kn">proxy_pass</span> <span class="s">http://www.example.com/link/</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This example configuration results in passing all requests processed in this
location to the proxied server at the specified address. This address can be
specified as a domain name or an IP address.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.1 - Describe NGINX as a load balancer</strong></p>
<p><a class="reference external" href="https://www.cloudflare.com/learning/performance/what-is-load-balancing/">https://www.cloudflare.com/learning/performance/what-is-load-balancing/</a></p>
<p><a class="reference external" href="https://nginx.org/en/docs/http/load_balancing.html">https://nginx.org/en/docs/http/load_balancing.html</a></p>
<p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/load-balancer/">https://docs.nginx.com/nginx/admin-guide/load-balancer/</a></p>
<p>Slide 14 <a class="reference external" href="https://f5u.csod.com/ui/lms-learning-details/app/course/f62cdc17-e0df-4117-820c-6270100981a2">https://f5u.csod.com/ui/lms-learning-details/app/course/f62cdc17-e0df-4117-820c-6270100981a2</a></p>
<p><strong>What is load balancing in the context of networking and web server</strong></p>
<p>Load balancing is the practice of distributing computational workloads between
two or more computers. On the Internet, load balancing is often employed to
divide network traffic among several servers. This reduces the strain on each
server and makes the servers more efficient, speeding up performance and
reducing latency. Load balancing is essential for most Internet applications to
function properly.</p>
<a class="reference internal image-reference" href="../../_images/without_load_balancing_diagram.png"><img alt="Without load balancing diagram" src="../../_images/without_load_balancing_diagram.png" style="height: 500px;" /></a>
<a class="reference internal image-reference" href="../../_images/with_load_balancing_diagram.png"><img alt="With load balancing diagram" src="../../_images/with_load_balancing_diagram.png" style="height: 500px;" /></a>
<p><strong>How can NGINX be seen as a load balancer</strong></p>
<p>It is possible to use nginx as a very efficient HTTP load balancer to
distribute traffic to several application servers and to improve performance,
scalability and reliability of web applications with nginx.</p>
<p>The simplest configuration for load balancing with nginx may look like the
following:</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">http</span> <span class="p">{</span>
    <span class="kn">upstream</span> <span class="s">myapp1</span> <span class="p">{</span>
        <span class="kn">server</span> <span class="s">srv1.example.com</span><span class="p">;</span>
        <span class="kn">server</span> <span class="s">srv2.example.com</span><span class="p">;</span>
        <span class="kn">server</span> <span class="s">srv3.example.com</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>

        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
            <span class="kn">proxy_pass</span> <span class="s">http://myapp1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the example above, there are 3 instances of the same application running on
srv1-srv3. When the load balancing method is not specifically configured, it
defaults to round-robin. All requests are proxied to the server group myapp1,
and nginx applies HTTP load balancing to distribute the requests.</p>
<p><em>TODO</em></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.1 - Describe NGINX as a caching solution</strong></p>
<p><a class="reference external" href="https://aws.amazon.com/caching/">https://aws.amazon.com/caching/</a></p>
<p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/content-cache/content-caching/">https://docs.nginx.com/nginx/admin-guide/content-cache/content-caching/</a></p>
<p><a class="reference external" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_cache">https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_cache</a></p>
<p><a class="reference external" href="https://www.f5.com/company/events/webinars/content-caching-nginx-plus">https://www.f5.com/company/events/webinars/content-caching-nginx-plus</a></p>
<p><strong>Caching in the context of the web</strong></p>
<p>Caching is a general concept referring to storing data in a high-speed storage
so that this data can be retrieved faster than possible when reaching its
original location. In the context of web, caching is crucial and is present at
many layers between the actual client software (e.g. web browser) and the
backend server or database, storing the content.</p>
<a class="reference internal image-reference" href="../../_images/diagram_caching.png"><img alt="Caching on the web diagram" src="../../_images/diagram_caching.png" style="height: 250px;" /></a>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="17%" />
<col width="7%" />
<col width="34%" />
<col width="17%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Layer</th>
<th class="head">Client-Side</th>
<th class="head">DNS</th>
<th class="head">Web</th>
<th class="head">App</th>
<th class="head">Database</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Use Case</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Accelerate retrieval of web content</div>
<div class="line">from websites (browser or device)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Domain to IP</div>
<div class="line">Resolution</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Accelerate retrieval of web content from web/app servers. Manage Web</div>
<div class="line">Sessions (server side) web/app servers. Manage Web Sessions (server side)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Accelerate application performance</div>
<div class="line">and data access</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Reduce latency associated with database</div>
<div class="line">query requests</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Technologies</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">HTTP Cache Headers, Browsers</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">DNS Servers</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">HTTP Cache Headers, CDNs, Reverse Proxies, Web Accelerators,</div>
<div class="line">Key/Value Stores</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Key/Value data stores, Local caches</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Database buffers, Key/Value data stores</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The above representation comes from the AWS article about caching
(<a class="reference external" href="https://aws.amazon.com/caching/">https://aws.amazon.com/caching/</a>) and depicts various levels at which caching
has influence in the context of web content serving.</p>
<p><strong>How NGINX can be seen as a caching solution</strong></p>
<p>NGINX leverages the caching capabilities of the web in multiple ways. Indeed,
NGINX as a reverse proxy or web server sits in a crucial place of web content
retrieval pipeline:</p>
<ul class="simple">
<li>Client-Side caching: NGINX can set and add HTTP headers helping the client
side to use caching.</li>
<li>Web and App content: NGINX can, through its <code class="docutils literal notranslate"><span class="pre">proxy_cache</span></code> directive, cache
the results of requests to the backend servers. These cached results can be
directly served to new clients, preventing making additional requests to the
backend servers. NGINX content caching can be fine-tuned, allowing to best
match the application logic. For example, highly dynamic pages may not be
cached to make sure the most up-to-date content is served to the clients,
while static files can be cached for longer time to prevent requesting the
backend server multiple times for identical files.</li>
<li>Web and App connections: another useful caching technique sits at the
transport layer. Thanks to its <code class="docutils literal notranslate"><span class="pre">keepalive</span></code> directives, NGINX can prevent
closing TCP sockets too early and reuse existing sockets instead of
re-negotiating a new connection. For the Transport Layer Security, NGINX also
has directives to cache SSL sessions and prevent re-negotiating keys and
certificates and reuse existing parameters with clients.</li>
</ul>
<p>These put together allow NGINX to vastly influence the caching of the web
content served by an application when it acts as a reverse proxy.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.1 - Describe NGINX as an API gateway</strong></p>
<p><a class="reference external" href="https://www.redhat.com/en/topics/api/what-does-an-api-gateway-do">https://www.redhat.com/en/topics/api/what-does-an-api-gateway-do</a></p>
<p><a class="reference external" href="https://www.f5.com/company/blog/nginx/deploying-nginx-plus-as-an-api-gateway-part-1">https://www.f5.com/company/blog/nginx/deploying-nginx-plus-as-an-api-gateway-part-1</a></p>
<p><strong>What is an API gateway</strong></p>
<p>An API gateway is an API management tool that sits between a client and a
collection of backend services. In this case, a client is the application on a
user’s device and the backend services are those on an enterprise’s servers.
API stands for application programming interface, which is a set of definitions
and protocols for building and integrating application software.</p>
<p>An API gateway is a component of application delivery (the combination of
services that serve an application to users) and acts as a reverse proxy to
accept all application programming interface (API) calls, aggregate the various
services required to fulfil them, and return the appropriate result. In
simpler terms, an API gateway is a piece of software that intercepts API calls
from a user and routes them to the appropriate backend service.</p>
<p><strong>How can NGINX be used as an API gateway</strong></p>
<p>NGINX can be configured as a perfect API gateway through various configuration
aspects:</p>
<ul class="simple">
<li>Load balancing and upstream definition. As seen before, NGINX can be
configured with an upstream servers pool and perform load balancing between
the different API servers. This allows to ensure that the API service can
scale and match different needs.</li>
<li>API routes definition. NGINX can be used to define the different API routes
available in the same way it defines static web content serving routes. This
allows to define broad (using REGEX matching URIs) and precise (using exact
matching URIs) endpoints, and control the private or restricted endpoint’s
access.</li>
<li>Request interception and rewriting for handling breaking changes. NGINX can,
for example, handle the redirection from legacy API routes to the new ones
through HTTP redirect and content rewriting.</li>
<li>Handling errors. NGINX can interpret HTTP errors received from the backend
and display the desired error pages or messages.</li>
<li>Authenticating endpoints. NGINX can handle restricting access to some
endpoints using authentication methods such as API keys or JSON Web Tokens.</li>
<li>Rate limiting and logging. NGINX can help to secure and enforcing policies on
endpoints by using its rate limiting or advanced logging features.</li>
</ul>
<p>All these aspects make NGINX an efficient and complete solution for placing it
as an API gateway.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="objective-1-2-explain-the-nginx-configuration-directory-structure">
<h2>Objective - 1.2 Explain the NGINX configuration directory structure<a class="headerlink" href="#objective-1-2-explain-the-nginx-configuration-directory-structure" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p><strong>1.2 - Identify the default NGINX core config file</strong></p>
<p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/">https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/</a></p>
<p><a class="reference external" href="https://stackoverflow.com/questions/19910042/locate-the-nginx-conf-file-my-nginx-is-actually-using">https://stackoverflow.com/questions/19910042/locate-the-nginx-conf-file-my-nginx-is-actually-using</a></p>
<p><a class="reference external" href="http://hg.nginx.org/pkg-oss/file/tip/debian/debian/nginx.conf">http://hg.nginx.org/pkg-oss/file/tip/debian/debian/nginx.conf</a></p>
<p><strong>Default configuration when installing NGINX</strong></p>
<p>NGINX configuration is managed through configuration file. After freshly
installing NGINX, a default core config file will be created and configure a
default NGINX web server. By default, the file is named <code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code> and for
NGINX Plus is placed in the <code class="docutils literal notranslate"><span class="pre">/etc/nginx</span> <span class="pre">directory</span></code>. (For NGINX Open Source,
the location depends on the package system used to install NGINX and the
operating system. It is typically one of <code class="docutils literal notranslate"><span class="pre">/usr/local/nginx/conf</span></code>, <code class="docutils literal notranslate"><span class="pre">/etc/nginx</span></code>,
or <code class="docutils literal notranslate"><span class="pre">/usr/local/etc/nginx</span></code>).</p>
<p>The default configuration may vary depending on your installation source
(different distribution maintained APT repositories, NGINX maintained APT
repositories, …). The following is installed when NGINX is installed from the
official NGINX repository on a Debian system:</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
<span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>

<span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">notice</span><span class="p">;</span>
<span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>


<span class="k">events</span> <span class="p">{</span>
    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">http</span> <span class="p">{</span>
    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>

    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&quot;</span><span class="nv">$request&quot;</span> <span class="s">&#39;</span>
                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&quot;</span><span class="nv">$http_referer&quot;</span> <span class="s">&#39;</span>
                    <span class="s">&#39;&quot;</span><span class="nv">$http_user_agent&quot;</span> <span class="s">&quot;</span><span class="nv">$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>

    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>

    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
    <span class="c1">#tcp_nopush     on;</span>

    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>

    <span class="c1">#gzip  on;</span>

    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The important bit is that there always is a default configuration installed
named <code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code> which install location depends on your system. There should
only be one install point: the commands <code class="docutils literal notranslate"><span class="pre">nginx</span> <span class="pre">-t</span></code> or <code class="docutils literal notranslate"><span class="pre">nginx</span> <span class="pre">-V</span></code> should display
the actually loaded configuration by NGINX.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.2 - Identify the included directories/files</strong></p>
<p><a class="reference external" href="http://nginx.org/en/docs/ngx_core_module.html#include">http://nginx.org/en/docs/ngx_core_module.html#include</a></p>
<p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/">https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/</a></p>
<p><a class="reference external" href="https://www.f5.com/company/blog/nginx/deploying-nginx-plus-as-an-api-gateway-part-1#organize-config">https://www.f5.com/company/blog/nginx/deploying-nginx-plus-as-an-api-gateway-part-1#organize-config</a></p>
<p><a class="reference external" href="https://stackoverflow.com/questions/50107845/what-is-the-order-of-the-config-file-for-nginx">https://stackoverflow.com/questions/50107845/what-is-the-order-of-the-config-file-for-nginx</a></p>
<p><strong>NGINX configuration across multiple files</strong></p>
<p>NGINX configuration can be divided into multiple files across multiple
directories. NGINX has the <code class="docutils literal notranslate"><span class="pre">include</span></code> directive which matches a certain number
of files (possibly using a wildcard <code class="docutils literal notranslate"><span class="pre">*</span></code> operator for matching multiple file
names, called a mask) and includes their content at the location of the
<code class="docutils literal notranslate"><span class="pre">include</span></code> directive in the configuration file.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">nginx</span> <span class="pre">-T</span></code> command shows the list of actually loaded configuration file,
taking into account the <code class="docutils literal notranslate"><span class="pre">include</span></code> directive.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.2 - Describe the order of how the included files will be ‘merged’ into the
running configuration</strong></p>
<p><a class="reference external" href="http://hg.nginx.org/nginx/file/tip/src/core/ngx_conf_file.c#l821">http://hg.nginx.org/nginx/file/tip/src/core/ngx_conf_file.c#l821</a></p>
<p><a class="reference external" href="https://stackoverflow.com/questions/50107845/what-is-the-order-of-the-config-file-for-nginx">https://stackoverflow.com/questions/50107845/what-is-the-order-of-the-config-file-for-nginx</a></p>
<p><strong>NGINX include configuration loading</strong></p>
<p>When making use of the <code class="docutils literal notranslate"><span class="pre">include</span></code> directive, the included files are like
“merged” (with some caveats as we will see in the next part) in the
configuration. Basically, the included file (child configuration) defines a
configuration that will inherit its parent’s (the file containing the <code class="docutils literal notranslate"><span class="pre">include</span>
<span class="pre">[...]</span></code> directive) variables and directives. However, the parent configuration
will never be able to access elements defined in a child configuration (despite
being in the same context “level”).</p>
<p>For example, let us have the following <code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code> file:</p>
<div class="highlight-NGINX notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># /etc/nginx/nginx.conf</span>
<span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
<span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>

<span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">notice</span><span class="p">;</span>
<span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>


<span class="k">events</span> <span class="p">{</span>
    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">http</span> <span class="p">{</span>
    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>

<span class="hll">    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&quot;</span><span class="nv">$request&quot;</span> <span class="s">&#39;</span>
</span><span class="hll">                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&quot;</span><span class="nv">$http_referer&quot;</span> <span class="s">&#39;</span>
</span><span class="hll">                    <span class="s">&#39;&quot;</span><span class="nv">$http_user_agent&quot;</span> <span class="s">&quot;</span><span class="nv">$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>
</span>
    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>

    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
    <span class="c1">#tcp_nopush     on;</span>

    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>

    <span class="c1">#gzip  on;</span>

<span class="hll">    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>and another <code class="docutils literal notranslate"><span class="pre">web.conf</span></code> file:</p>
<div class="highlight-NGINX notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># /etc/nginx/conf.d/web.conf</span>
<span class="hll"><span class="k">log_format</span>  <span class="s">web</span>  <span class="s">&#39;Custom</span> <span class="s">logging:</span> <span class="nv">$remote_addr&#39;</span><span class="p">;</span>
</span>
<span class="k">server</span> <span class="p">{</span>
    <span class="kn">root</span> <span class="s">/www/data</span><span class="p">;</span>
<span class="hll">    <span class="kn">access_log</span> <span class="s">/var/log/nginx/web.log</span> <span class="s">main</span><span class="p">;</span>
</span><span class="hll">    <span class="kn">access_log</span> <span class="s">/var/log/nginx/web.log</span> <span class="s">web</span><span class="p">;</span>
</span>
    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Note the following file hierarchy on the system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/etc/nginx/
├─ conf.d/
│  ├─ web.conf
├─ nginx.conf
├─ mime.types
</pre></div>
</div>
<p>The NGINX configuration will load the content from the
<code class="docutils literal notranslate"><span class="pre">/etc/nginx/conf.d/web.conf</span></code> file because it matches the mask defined in
<code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">/etc/nginx/conf.d/*.conf;</span></code>: therefore, the server block defined in
the <code class="docutils literal notranslate"><span class="pre">web.conf</span></code> file will create an HTTP server listening on host’s port 80
and serving static files from the <code class="docutils literal notranslate"><span class="pre">/wwww/data</span></code> directory. This <code class="docutils literal notranslate"><span class="pre">server</span></code>
block defined in <code class="docutils literal notranslate"><span class="pre">web.conf</span></code> will inherit the elements defined in the
<code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code> file: the <code class="docutils literal notranslate"><span class="pre">http</span> <span class="pre">{}</span></code> context and the general main context.</p>
<p>For example, in <code class="docutils literal notranslate"><span class="pre">web.conf:L6</span></code>, the <code class="docutils literal notranslate"><span class="pre">access_log</span></code> directive writes a new log
entry using the format <code class="docutils literal notranslate"><span class="pre">main</span></code> defined in <code class="docutils literal notranslate"><span class="pre">nginx.conf:L18-20</span></code>: <strong>the child
configuration inherits the parent’s context</strong>. However, the log format defined
in <code class="docutils literal notranslate"><span class="pre">web.conf:L2</span></code> would not be usable anywhere in <code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code>: <strong>the parent
configuration does not inherit the child’s context, despite being on the same
context “level”</strong> – the <code class="docutils literal notranslate"><span class="pre">log_format</span></code> directive in <code class="docutils literal notranslate"><span class="pre">web.conf:L2</span></code> is not in
a sub-block, so in the same context “level” –. However, the newly defined log
format can and is used to write an access log, as defined in <code class="docutils literal notranslate"><span class="pre">web.conf:L7</span></code>.</p>
<p>Although we do not extend the example to show it, note that sibling
configuration also only inherit their parent’s context: a file
<code class="docutils literal notranslate"><span class="pre">/etc/nginx/conf.d/backend.conf</span></code> would also not be able to use the
<code class="docutils literal notranslate"><span class="pre">access_log</span> <span class="pre">[...]</span> <span class="pre">web</span></code> directive.</p>
<p>Note that this inclusion concept intertwines to some extent with the
inheritance concept, please keep reading to understand how the context works.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.2 - Describe directive inheritance and overriding properties</strong></p>
<p><a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/">https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/</a></p>
<p><a class="reference external" href="https://www.slingacademy.com/article/nginx-base-module-directives-complete-guide/#Variables_and_Inheritance_in_NGINX">https://www.slingacademy.com/article/nginx-base-module-directives-complete-guide/#Variables_and_Inheritance_in_NGINX</a></p>
<p><a class="reference external" href="https://blog.martinfjordvald.com/understanding-the-nginx-configuration-inheritance-model/">https://blog.martinfjordvald.com/understanding-the-nginx-configuration-inheritance-model/</a></p>
<p><a class="reference external" href="https://nginx.org/en/docs/http/request_processing.html">https://nginx.org/en/docs/http/request_processing.html</a></p>
<p><strong>Elements of an NGINX configuration file</strong></p>
<p>Before going any further, we will recall the definition of some elements of the
NGINX configuration file.</p>
<dl class="docutils">
<dt>Directives (simple directives and blocks)</dt>
<dd><p class="first">The configuration file consists of directives and their parameters.
<strong>Simple</strong> (single-line) <strong>directives</strong> each end with a semicolon. Other
directives act as “containers” that group together related directives,
enclosing them in curly braces (<code class="docutils literal notranslate"><span class="pre">{}</span></code>); these are often referred to as
<strong>blocks</strong>. Here are some examples of simple directives:</p>
<div class="last highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">user</span>             <span class="s">nobody</span><span class="p">;</span>
<span class="k">error_log</span>        <span class="s">logs/error.log</span> <span class="s">notice</span><span class="p">;</span>
<span class="k">worker_processes</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</dd>
<dt>Contexts</dt>
<dd><p class="first">A few top-level directives, referred to as contexts, group together the
directives that apply to different traffic types:
- <strong>events</strong> - General connection processing
- <strong>http</strong> - HTTP traffic
- <strong>mail</strong> - Mail traffic
- <strong>stream</strong> - TCP and UDP traffic</p>
<p class="last">Directives placed outside these contexts are said to be in the main
context. The context defines the available directives and variable to be
used for request processing inside the context. For example the
<code class="docutils literal notranslate"><span class="pre">$request_method</span></code> variable can be used inside a <code class="docutils literal notranslate"><span class="pre">http</span> <span class="pre">{}</span></code> context
block, but not inside a <code class="docutils literal notranslate"><span class="pre">stream</span> <span class="pre">{}</span></code> context block, as it would not make
sense to have an HTTP method inside any TCP/UDP stream.</p>
</dd>
<dt>Virtual Servers</dt>
<dd><p class="first">In each of the traffic-handling contexts, you include one or more <strong>server
blocks</strong> to define virtual servers that control the processing of requests.
The directives you can include within a server context vary depending on
the traffic type.</p>
<p>For HTTP traffic (the http context), each server directive controls the
processing of requests for resources at particular domains or IP addresses.
One or more location contexts in a server context define how to process
specific sets of URIs.</p>
<p class="last">For mail and TCP/UDP traffic (the mail and stream contexts) the server
directives each control the processing of traffic arriving at a particular
TCP port or UNIX socket.</p>
</dd>
</dl>
<p>The following code block is a sample configuration, commented with details on
the different contexts.</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">user</span> <span class="s">nobody</span><span class="p">;</span> <span class="c1"># a directive in the &#39;main&#39; context</span>

<span class="k">events</span> <span class="p">{</span>
    <span class="c1"># configuration of connection processing</span>
<span class="p">}</span>

<span class="k">http</span> <span class="p">{</span>
    <span class="c1"># Configuration specific to HTTP and affecting all virtual servers</span>

    <span class="kn">server</span> <span class="p">{</span>
        <span class="c1"># configuration of HTTP virtual server 1</span>
        <span class="kn">location</span> <span class="s">/one</span> <span class="p">{</span>
            <span class="c1"># configuration for processing URIs starting with &#39;/one&#39;</span>
        <span class="p">}</span>
        <span class="kn">location</span> <span class="s">/two</span> <span class="p">{</span>
            <span class="c1"># configuration for processing URIs starting with &#39;/two&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kn">server</span> <span class="p">{</span>
        <span class="c1"># configuration of HTTP virtual server 2</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">stream</span> <span class="p">{</span>
    <span class="c1"># Configuration specific to TCP/UDP and affecting all virtual servers</span>
    <span class="kn">server</span> <span class="p">{</span>
        <span class="c1"># configuration of TCP virtual server 1</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Inheritance and properties overriding</strong></p>
<p>In general, a <strong>child context</strong> - one contained within another context (its
parent) - <strong>inherits the settings of directives</strong> included at the parent level.
Some directives can appear in multiple contexts, in which case you can
<strong>override</strong> the setting inherited from the parent by including the directive
in the child context. The following gives an example of override <code class="docutils literal notranslate"><span class="pre">root</span></code>
directive:</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">root</span> <span class="s">/home/user/public_html</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/app</span> <span class="p">{</span>
        <span class="kn">root</span> <span class="s">/usr/share</span><span class="p">;</span> <span class="c1"># This directive overrides the root directive from parent context.</span>
                         <span class="c1"># This results in /usr/share/app</span>
                         <span class="c1"># (Full URI is always appended.)</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="s">/app2</span> <span class="p">{</span>
        <span class="c1"># Server context root applies here because it is inherited by</span>
        <span class="c1"># the parent context.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This simple rule of thumb however mixes with other NGINX rules which can make
surprising the understanding of some specific configuration files.</p>
<p>Notably, there can be confusion when writing directives in a nested <code class="docutils literal notranslate"><span class="pre">location</span>
<span class="pre">{}</span></code> block: NGINX always processes requests by matching the most specific paths.
Therefore, although there can be shorter but valid matches, directives in
locations other than the most specific ones will not get executed. The
following example shows it:</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">location</span> <span class="s">/calendar</span> <span class="p">{</span>
        <span class="kn">rewrite</span> <span class="s">^</span> <span class="s">/static.php</span><span class="p">;</span> <span class="c1"># Executes unless inner location matches.</span>

        <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
            <span class="kn">fastcgi_pass</span> <span class="s">backend</span><span class="p">;</span> <span class="c1"># Outer location context rewrite is not executed.</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Also, using inheritance, one must be careful to take into account the
documentation and specifications of each directive which may have
specificities. For example, the <code class="docutils literal notranslate"><span class="pre">rewrite</span></code> directive is specifically documented
as “executed sequentially in order of their appearance in the configuration
file”. This example shows how:</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">rewrite</span> <span class="s">^/booking(.*)</span> <span class="s">/calendar</span><span class="nv">$1</span> <span class="s">permanent</span><span class="p">;</span> <span class="c1"># Always executes.</span>

    <span class="kn">location</span> <span class="s">/calendar</span> <span class="p">{</span>
        <span class="kn">rewrite</span> <span class="s">^</span> <span class="s">/index.php</span><span class="p">;</span> <span class="c1"># Can execute in addition to and does not replace server context rewrites.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Therefore, the directive is not override by the child context redefinition as
would other directives.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="objective-1-3-demonstrate-how-to-manage-user-permissions">
<h2>Objective - 1.3 Demonstrate how to manage user permissions<a class="headerlink" href="#objective-1-3-demonstrate-how-to-manage-user-permissions" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p id="user-context-identification"><strong>1.3 - Identify user context (i.e. using the configuration file)</strong></p>
<p><a class="reference external" href="https://nginx.org/en/docs/ngx_core_module.html#user">https://nginx.org/en/docs/ngx_core_module.html#user</a></p>
<p><a class="reference external" href="https://stackoverflow.com/questions/42329261/running-nginx-as-non-root-user">https://stackoverflow.com/questions/42329261/running-nginx-as-non-root-user</a></p>
<p><strong>The user directive</strong></p>
<p>From the documentation, the <code class="docutils literal notranslate"><span class="pre">user</span></code> directive allows to define the user and
group credentials used by worker processes. To be noted, the main processes is
run by root by default, because listening on port below 1024 (which is often
done by NGINX) requires root permissions on Linux. There <cite>exist ways
&lt;https://stackoverflow.com/questions/42329261/running-nginx-as-non-root-user&gt;</cite>
to run the main process as non-root if you create virtual server only listening
on ports above 1024.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.3 - Describe how and when to give read/write/execute access</strong></p>
<p><a class="reference external" href="https://www.slingacademy.com/article/nginx-user-and-group-explained-with-examples/">https://www.slingacademy.com/article/nginx-user-and-group-explained-with-examples/</a></p>
<p><a class="reference external" href="https://linuxize.com/post/chmod-command-in-linux/">https://linuxize.com/post/chmod-command-in-linux/</a></p>
<p><strong>NGINX users and tasks</strong></p>
<p>As seen before, there are 2 important users (in the sense of a UNIX user) in
the NGINX system: <code class="docutils literal notranslate"><span class="pre">root</span></code>, which executes the main process and the workers,
which user is defined by the <code class="docutils literal notranslate"><span class="pre">user</span></code> directive or <code class="docutils literal notranslate"><span class="pre">nobody</span></code> by default.</p>
<p>On another side, there are the tasks the these processes must run. The main
process being run by the system’s <code class="docutils literal notranslate"><span class="pre">root</span></code>, it will have sufficient rights to
perform its tasks (listening to sockets, parsing and reading configuration
files, …).</p>
<p>The worker process need to process the actual requests, meaning they must be
able to read the static files they are supposed to serve and write logs from
their request’s processing.</p>
<p><strong>How to give access</strong></p>
<p>Giving access to certain elements requires following the classic Linux access
control system: any file or folder has a user owner and a group owner. For the
owner, the group owner and the other users (everyone), one defines
authorizations to read, write and execute. Modifying these accesses is as
simple as using the <code class="docutils literal notranslate"><span class="pre">chmod</span></code> and/or <code class="docutils literal notranslate"><span class="pre">chown</span></code> commands to respectively modify
the authorization and owner of files.</p>
<p>For example, the following command modifies the owner of the <code class="docutils literal notranslate"><span class="pre">/data/wwww</span></code>
folder and all the files and folders it contains to make it owned by the
<code class="docutils literal notranslate"><span class="pre">nginx</span></code> user:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo chown -R nginx /data/wwww
</pre></div>
</div>
<p>The next command makes the file <code class="docutils literal notranslate"><span class="pre">/data/www/index.html</span></code> readable, writeable
and executable for the owner, but only readable and executable for the group
owner and for everyone else:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo chown <span class="m">755</span> /data/wwww/index.html
</pre></div>
</div>
<p>For more information, one should check the referenced links about changing the
access rights of Linux files.</p>
<p><strong>When and to what give access</strong></p>
<p>The last step is understanding which accesses should be given. The answer is
simply “enough for the workers to do their job” basically. This means that the
worker should have at least the read permission to get the content of the files
they are serving, and write access to the log files they write their logs to.</p>
<p>Many possible configurations are possible: one should only make sure that the
choice of user for the worker does not prevent them from accessing the files
they need to access.</p>
<p>Note that observing the logs from the <code class="docutils literal notranslate"><span class="pre">nginx</span> <span class="pre">-t</span></code> command to check the
configuration will give you information about problematic access write
(unwritable access logs for example).</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.3 - Describe how to run NGINX as a specific user type</strong></p>
<p>As describe in <a class="reference internal" href="#user-context-identification">user context identification</a>, the <code class="docutils literal notranslate"><span class="pre">user</span></code> directive in the
configuration file defines the Linux user under which the NGINX worker will
run. Changing this to the desired user allows to run the NGINX as a specific
user. Doing this, one must make sure the access rights are updated accordingly
for the system to run.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>1.3 - Describe the relationship between NGINX processes and users</strong></p>
<p><a class="reference external" href="http://haifux.org/lectures/84-sil/users-processes-files-and-permissions/users-perms-lec.html">http://haifux.org/lectures/84-sil/users-processes-files-and-permissions/users-perms-lec.html</a></p>
<p><a class="reference external" href="http://nginx.org/en/docs/control.html">http://nginx.org/en/docs/control.html</a></p>
<p><strong>Linux processes</strong></p>
<p>In order to understand this aspect, the reader must first make sure they
understand the Linux users and process system. Here are a few reminders from
the cited sources.</p>
<ul class="simple">
<li>Every process running on a Linux system, executes on behalf of a given User.</li>
<li>Thus, the process may do what this User is allowed to do.</li>
<li>The process may access the Files that its User-owner may access.</li>
<li>Every process has unique process ID (= pid), which can be used to control the
process.</li>
</ul>
<p>There of course exist many other subtleties in the Linux files and access
managements (symbolic links, set UID and set GID flags) which deserve their own
lessons and could not be covered here. The reader may however read through the
cited source to learn more.</p>
<p><strong>NGINX processes</strong></p>
<p>You can run the following command on your system running NGINX:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ps axw -o pid,ppid,user,%cpu,vsz,wchan,command <span class="p">|</span> egrep <span class="s1">&#39;(nginx|PID)&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ps</span></code> is the Linux process listing command, the <code class="docutils literal notranslate"><span class="pre">axu</span></code> option lists all the
processes running on the current system, the <code class="docutils literal notranslate"><span class="pre">-o</span>
<span class="pre">pid,ppid,user,%cpu,vsz,wchan,command</span></code> flag specifies the display format
columns to show as output and finally, the <code class="docutils literal notranslate"><span class="pre">egrep</span></code> command filters the lines
from the output that refer to NGINX or the first line (containing ‘PID’).</p>
<p>This should give an output looking more or less like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  PID    PPID USER     %CPU    VSZ WCHAN  COMMAND
<span class="m">12146</span>       <span class="m">1</span> root      <span class="m">0</span>.0  <span class="m">75440</span> sigsus nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
<span class="m">13050</span>   <span class="m">12146</span> nginx     <span class="m">0</span>.0 <span class="m">182548</span> do_epo nginx: worker process
<span class="m">13051</span>   <span class="m">12146</span> nginx     <span class="m">0</span>.0  <span class="m">76032</span> do_epo nginx: worker process
</pre></div>
</div>
<p>You can here see the main process, running under the <code class="docutils literal notranslate"><span class="pre">root</span></code> user, while 2
worker processes are running under the <code class="docutils literal notranslate"><span class="pre">nginx</span></code> user. The NGINX processes are
Linux processes, hence this is why they run on the behalf of Linux users, in
our case, the <code class="docutils literal notranslate"><span class="pre">root</span></code> and the <code class="docutils literal notranslate"><span class="pre">nginx</span></code> users.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="objective-1-4-manage-shared-memory-zones">
<h2>Objective - 1.4 Manage shared memory zones<a class="headerlink" href="#objective-1-4-manage-shared-memory-zones" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p><strong>1.4 - Describe how and why NGINX uses shared memory zones</strong></p>
<p><a class="reference external" href="https://stackoverflow.com/questions/38295426/what-does-the-shared-memory-zone-mean-in-nginx">https://stackoverflow.com/questions/38295426/what-does-the-shared-memory-zone-mean-in-nginx</a></p>
<p><a class="reference external" href="https://nginx.org/en/docs/dev/development_guide.html#shared_memory">https://nginx.org/en/docs/dev/development_guide.html#shared_memory</a></p>
<p><a class="reference external" href="https://thelinuxcode.com/using_mmap_function_linux/">https://thelinuxcode.com/using_mmap_function_linux/</a></p>
<p><strong>Shared memory zones in Linux</strong></p>
<p>Getting back to basics, system oriented software use system calls to ask their
host operating system to allocate memory for them. Usually, for simple
programs, the allocated memory zone belongs to this program only: the OS should
try to prevent other processes from accessing this memory zone. For example, on
our server, we would not want the web server process to access the memory space
of the SSH server, as it may allow the web server process to read secret
information from the SSH server process.</p>
<p>However, in some controlled circumstances, we do want multiple processes to
share some memory space allocated by the OS as they should work together on the
same data. In this context, shared memory serves as an Inter Process
Communication channel. There are many possible Inter Process Communication
channels (the network, UNIX sockets, …), but shared memory sits at the lower
level and allows for very efficient communication, removing any overhead caused
by using, for example, the network stack (no need to establish a TCP handshake
between two processes).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mmap()</span></code> Linux system calls is the basic system call for requiring memory
allocation (it is for example the system call used by the <code class="docutils literal notranslate"><span class="pre">malloc()</span></code> C
function). Through this system call and using the correct options, one can ask
the operating system to allocate a certain amount of memory that can be shared
between different processes and used as any memory space through pointers. This
is exactly what is done by NGINX when allocating a new shared memory zone.</p>
<p><strong>NGINX using shared memory zones</strong></p>
<p>Shared memory being one of the most efficient inter process communication
system, it is the privileged option by NGINX for sharing runtime information
required by different worker processes. Among the use cases, we notably notice
the <strong>rate limiting</strong> one.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">limit_conn</span></code> directive requires a shared memory zone being parametrized.
Indeed, upon subsequent connection handling, different worker process may
process the received connection. Meaning that, a bad actor making too many
requests on a server would only need to be as lucky as being handled by a new
worker process to have its connection rate be considered as fresh as new.
Therefore, worker processes need to tell each other how many requests every
client made, so they can successfully enforce blocking. You may see this as a
bouncer team: they need to share who they saw and blocked, so the other team
members can benefit from this knowledge and directly block a bad actor if it
was flagged as bad the other team members.</p>
<p>Shared memory zones are for example also used to store the proxy cache keys for
sharing the set of keys:cache_path pairs among different workers. This one
could be seen as a team of librarians who share their index for the book shelve
just behind their desk storing the most used books.</p>
<div align="center" class="align-center"><img alt="Example with bouncers for shared memory explanation" src="../../_images/shared-rate-limiting-example.svg" /></div>
<p><strong>How to create a shared memory zone in NGINX</strong></p>
<p>Using the rate limiting use case example, the following configuration:</p>
<div class="highlight-NGINX notranslate"><div class="highlight"><pre><span></span><span class="k">http</span> <span class="p">{</span>
    <span class="kn">limit_req_zone</span> <span class="nv">$binary_remote_addr</span>
    <span class="s">zone=limitbyaddr:10m</span> <span class="s">rate=3r/s</span><span class="p">;</span>
    <span class="kn">limit_req_status</span> <span class="mi">429</span><span class="p">;</span>
    <span class="c1"># ...</span>
    <span class="kn">server</span> <span class="p">{</span>
        <span class="c1"># ...</span>
        <span class="kn">limit_req</span> <span class="s">zone=limitbyaddr</span><span class="p">;</span>
        <span class="c1"># ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This example configuration creates a shared memory zone named <code class="docutils literal notranslate"><span class="pre">limitbyaddr</span></code>.
The predefined key used is the client’s IP address in binary form. The size of
the shared memory zone is set to 10 MB. The zone sets the rate with a keyword
argument. The limit_req directive takes a required keyword argument: <code class="docutils literal notranslate"><span class="pre">zone</span></code>.
<code class="docutils literal notranslate"><span class="pre">zone</span></code> instructs the directive on which shared memory request-limit zone to
use. <a class="reference internal" href="#cookbook-p34" id="id1">[COOKBOOK_P34]</a></p>
<table class="docutils citation" frame="void" id="cookbook-p34" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[COOKBOOK_P34]</a></td><td>DEJONGHE, NGINX COOKBOOK Advanced Recipes for High
-Performance Load Balancing., 34.</td></tr>
</tbody>
</table>
<p><strong>1.4 - Describe why directives use a shared memory zone</strong></p>
<p>The above example and description also answers this aspect. We could summarize
this by the following: for some specific needs (such as consistent rate
limiting), NGINX workers need to share very efficiently information for quickly
reading and writing data and efficiently serve or block clients. Shared memory
zones allow defining and assign OS backed memory zones that can be written and
read by multiple NGINX workers. Doing so, they can share and update each other
to fulfil the contract of some directives (such as rate limiting) with an
efficient inter process communication channel.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="../class21.html" title="F5 N1-N4 - NGINX OSS - NOT CREATED" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="module2.html" title="F5N2 - Configuration: Knowledge" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>